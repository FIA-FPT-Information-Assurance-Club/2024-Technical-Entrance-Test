<?php
    if(isset($_POST['command'],$_POST['target'])){
        $command = $_POST['command'];
        $target = $_POST['target'];
        switch($command) {
			case "backup":
                # Backup to /tmp/ folder and prevent writable to document root 
				$result = shell_exec("timeout 3 zip /tmp/$target -r /var/www/html/index.php 2>&1");
                die("Đã chạy câu lệnh backup");
                break;
            // CHANGELOG: Bảo trì
			// case "ping":
			// 	$result = shell_exec("timeout 10 ping -c 4 $target &2 > 1");
			// 	break;
			// case "nslookup":
			// 	$result = shell_exec("timeout 10 nslookup $target &2 > 1");
			// 	break;	
			// case "dig":
			// 	$result = shell_exec("timeout 10 dig $target &2 > 1");
			// 	break;
		}
        die("Một số chức năng đang được bảo trì. Mời bạn nạp tiền để có thể tiếp tục duy trì dự án");
    }
?>
<html>
<head>
    <title>Time Adventure</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/sketchy/bootstrap.min.css" integrity="sha384-RxqHG2ilm4r6aFRpGmBbGTjsqwfqHOKy1ArsMhHusnRO47jcGqpIQqlQK/kmGy9R" crossorigin="anonymous">
    <lin rel="stylesheet" href="https://getbootstrap.com/docs/4.0/examples/cover/cover.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js" integrity="sha512-WNLxfP/8cVYL9sj8Jnp6et0BkubLP31jhTG9vhL/F5uEZmg5wEzKoXp1kJslzPQWwPT1eyMiSxlKCgzHLOTOTQ==" crossorigin="anonymous"></script>
    <style>
        pre {
    white-space: pre-wrap;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
    white-space: -pre-wrap;      /* Opera 4-6 */
    white-space: -o-pre-wrap;    /* Opera 7 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
}
    </style>
</head>
<body>
<div class="container">
    <div class="page-header" id="banner">
        <div class="row">
            <div class="col-lg-12">
                    <h1 class="cover-heading">Backup Tool using Zip</h1>
                    <form action="#" id=backup_tool>
                    <select name=command>
                        <option value="backup">backup</option>
                        <option value="nslookup">nslookup</option>
                        <option value="ping">ping</option>
                        <option value="dig">dig</option>
                    </select>
                        <input type=text name=target />
                        <button class="btn btn-primary">check</button>
                    </form>
                    <pre id=result></pre>
            </div>
        </div>
	</div>
</div>

</body>
<script>
    var backup_tool = document.getElementById('backup_tool');
    var result_div = document.getElementById('result');

    function logSubmit(event) {
        event.preventDefault();
        $.post('index.php',$(backup_tool).serialize(),function(data){
            result_div.innerText = data;
        });
    }
    backup_tool.addEventListener('submit', logSubmit);
</script>
</html>
